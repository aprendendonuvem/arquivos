<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horários das Salas</title>
    <style>
        body {font-family: Arial, sans-serif;background-color: #121212;color: white;margin: 20px;}
        .container {display: flex;flex-wrap: wrap;/* flex-direction: column; */gap: 20px;}
        .periodo {background-color: #1e1e1e;padding: 10px;border-radius: 8px;box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);}
        .salas {display: flex;flex-wrap: wrap;gap: 10px;justify-content: flex-start;}
        .sala {background-color: #2a2a2a;padding: 10px;border-radius: 8px;box-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
            flex: 1 1 calc(25% - 10px);min-width: 350px;max-width: 350px;box-sizing: border-box;}
        table {width: 100%;border-collapse: collapse;}
        th, td {border: 1px solid #555;padding: 8px;text-align: left;font-size: 14px;}
        th {background-color: #333;}
        .floating-label {position: fixed;top: 20px;background-color: #1e1e1e;padding: 10px;
        border-radius: 8px;box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);font-size: 14px;}
        .primeiro{ left: 20px; }
        .segundo{ left: 150px; }
        .terceiro{ left: 260px; }
        .quarto{ left: 430px; }
        .h1lab{ text-align: end; margin: 0;}
        .floating-back {    position: fixed;top: 20px;left: 620px;background-color: #1e1e1e;padding: 10px;border-radius: 8px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);font-size: 14px;}
        .floating-back a {color: white;text-decoration: none;font-weight: bold;}
        .floating-back a:hover {color: #ddd;}

    </style>
</head>
<body>
    <label class="floating-back">
        <a href="index.html">⬅ Voltar para a Página Inicial</a>
    </label>
    

    <!-- <h1 class="h1lab">Laboratórios de informática</h1> -->
    <label class="floating-label primeiro">
        <input type="checkbox" id="auto-update" onchange="toggleAtualizacaoAutomatica()" > Hora Atual
    </label>
   

    <select id="dia-semana" onchange="gerarTabelas()" class="floating-label segundo">
        <option value="Segunda">Segunda</option>
        <option value="Terça">Terça</option>
        <option value="Quarta">Quarta</option>
        <option value="Quinta">Quinta</option>
        <option value="Sexta">Sexta</option>
    </select>

    <select id="periodo-selecionado" onchange="gerarTabelas()" class="floating-label terceiro">
        <option value="todos">Todos os períodos</option> <!-- Adicionando a opção "Todos os períodos" -->
        <option value="manha">Manhã</option>
        <option value="tarde">Tarde</option>
        <option value="noite">Noite</option>
        <option value="noiteTecnico">Noite Técnico</option>
    </select>

    <select id="horario-selecionado" onchange="gerarTabelas()" class="floating-label quarto">
        <option value="">Todos os horários</option>
        <!-- Filtros de horário específicos para cada período -->
        <option value="7h10 - 8h00">7h10 - 8h00</option>
        <option value="8h00 - 8h50">8h00 - 8h50</option>
        <option value="8h50 - 9h40">8h50 - 9h40</option>
        <option value="10h00 - 10h50">10h00 - 10h50</option>
        <option value="10h50 - 11h40">10h50 - 11h40</option>
        <option value="11h40 - 12h30">11h40 - 12h30</option>

        <!-- Filtros de horário específicos para a tarde -->
        <option value="13h00 - 13h50">13h00 - 13h50</option>
        <option value="13h50 - 14h40">13h50 - 14h40</option>
        <option value="14h40 - 15h30">14h40 - 15h30</option>
        <option value="15h50 - 16h40">15h50 - 16h40</option>
        <option value="16h40 - 17h30">16h40 - 17h30</option>
        <option value="17h30 - 18h20">17h30 - 18h20</option>

        <!-- Filtros de horário específicos para a noite -->
        <option value="17h40 - 18h30">17h40 - 18h30</option>
        <option value="18h30 - 19h20">18h30 - 19h20</option>
        <option value="19h20 - 20h10">19h20 - 20h10</option>
        <option value="20h10 - 21h00">20h10 - 21h00</option>
        <option value="21h10 - 22h00">21h10 - 22h00</option>
        <option value="22h00 - 22h50">22h00 - 22h50</option>

        <!-- Filtros de horário específicos para a noite técnico -->
        <option value="18:50 - 20:42">18:50 - 20:42</option>
        <option value="20:55 - 22:47">20:55 - 22:47</option>
    </select>

    <div class="container" id="salas-container"></div>
    <!-- <button onclick="atualizarHorario()">Atualizar Horário</button> -->


    <script>
    let intervaloAtualizacao = null;

    function toggleAtualizacaoAutomatica() {
        const checkbox = document.getElementById("auto-update");

        if (checkbox.checked) {
            // Inicia a atualização automática a cada 1 minuto (60.000 ms)
            intervaloAtualizacao = setInterval(atualizarHorario, 60000);
            atualizarHorario(); // Executa uma vez imediatamente
        } else {
            // Para a atualização automática
            clearInterval(intervaloAtualizacao);
            location.reload(); // Executa uma vez imediatamente

        }
    }

    function atualizarHorario() {
        const horarios = [
            "7h10 - 8h00", "8h00 - 8h50", "8h50 - 9h40", "10h00 - 10h50", "10h50 - 11h40", "11h40 - 12h30",
            "13h00 - 13h50", "13h50 - 14h40", "14h40 - 15h30", "15h50 - 16h40", "16h40 - 17h30", "17h30 - 18h20",
            "17h40 - 18h30", "18h30 - 19h20", "19h20 - 20h10", "20h10 - 21h00", "21h10 - 22h00", "22h00 - 22h50",
            "18:50 - 20:42", "20:55 - 22:47"
        ];
    
        const agora = new Date();
        const horaAtual = agora.getHours();
        const minutoAtual = agora.getMinutes();
        const horarioFormatado = horaAtual.toString().padStart(2, '0') + "h" + minutoAtual.toString().padStart(2, '0');
    
        function converterParaMinutos(horario) {
            const [inicio, fim] = horario.split(" - ");
            const [h1, m1] = inicio.split(/h|:/).map(Number);
            const [h2, m2] = fim.split(/h|:/).map(Number);
            return [(h1 * 60 + m1), (h2 * 60 + m2)];
        }
    
        let horarioSelecionado = horarios.find(horario => {
            const [inicio, fim] = converterParaMinutos(horario);
            const minutosAtuais = horaAtual * 60 + minutoAtual;
            return minutosAtuais >= inicio && minutosAtuais <= fim;
        });
    
        if (horarioSelecionado) {
            document.getElementById("horario-selecionado").value = horarioSelecionado;
            document.getElementById("periodo-selecionado").value = "todos";
            gerarTabelas();
        }
    }
        let dadosSalasManha = [];
        let dadosSalasTarde = [];
        let dadosSalasNoite = [];
        let dadosSalasNoiteTecnico = [];

        async function baixarArquivo(url, periodo) {
        try {
            const resposta = await fetch(url);
            if (!resposta.ok) {
                throw new Error(`Erro HTTP: ${resposta.status}`);
            }
            const csv = await resposta.text();
            processarCSV(csv, periodo);
        } catch (erro) {
            console.error(`Erro ao baixar ${url}:`, erro);
        }
    }

    // Chamando as funções para baixar os arquivos automaticamente
    document.addEventListener("DOMContentLoaded", () => {
        baixarArquivo("https://aprendendonuvem.github.io/arquivos/laboratoriosManha.csv", "manha");
        baixarArquivo("https://aprendendonuvem.github.io/arquivos/laboratoriosTarde.csv", "tarde");
        baixarArquivo("https://aprendendonuvem.github.io/arquivos/laboratoriosNoite.csv", "noite");
        baixarArquivo("https://aprendendonuvem.github.io/arquivos/laboratoriosTecnico.csv", "noiteTecnico");
    });



        // Função para processar cada arquivo CSV
        function processarCSV(csv, periodo) {
            const linhas = csv.split('\n').map(linha => linha.trim()).filter(linha => linha);
            let salaAtual = null;

            // Define a quantidade de linhas por sala conforme o período
            const linhasPorSala = (periodo === 'noiteTecnico') ? 10 : 14;

            for (let i = 0; i < linhas.length; i += linhasPorSala) {
                salaAtual = {
                    nome: linhas[i].split(';')[0],
                    horarios: []
                };

                const diasSemana = linhas[i + 1].split(';');

                // Determina o início correto das disciplinas e professores com base no período
                const inicioLinhas = 2;
                const fimLinhas = (periodo === 'noiteTecnico') ? 10 : 14;

                for (let j = inicioLinhas; j < fimLinhas; j += 2) {
                    if (!linhas[i + j] || !linhas[i + j + 1]) continue;

                    const disciplinas = linhas[i + j].split(';');
                    const professores = linhas[i + j + 1].split(';');
                    const horario = disciplinas.pop(); // Último valor da linha é o horário

                    diasSemana.slice(0, 5).forEach((dia, index) => {
                        salaAtual.horarios.push({
                            periodo,
                            dia,
                            disciplina: disciplinas[index],
                            professor: professores[index],
                            horario
                        });
                    });
                }

                // Adiciona à lista do período correspondente
                if (periodo === 'manha') dadosSalasManha.push(salaAtual);
                if (periodo === 'tarde') dadosSalasTarde.push(salaAtual);
                if (periodo === 'noite') dadosSalasNoite.push(salaAtual);
                if (periodo === 'noiteTecnico') dadosSalasNoiteTecnico.push(salaAtual);
            }
            gerarTabelas();
        }


        
        function capitalizeWords(str) {
            return str.split(" ").map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
        }


        // Função para gerar as tabelas filtradas
        function gerarTabelas() {
            const diaSelecionado = document.getElementById('dia-semana').value;
            const horarioSelecionado = document.getElementById('horario-selecionado').value;
            const periodoSelecionado = document.getElementById('periodo-selecionado').value;
            const container = document.getElementById('salas-container');
            container.innerHTML = ''; // Limpa antes de renderizar novamente

            // Estrutura para armazenar os períodos e organizar a exibição
            const periodos = {
                manha: { nome: "", dados: dadosSalasManha },
                tarde: { nome: "", dados: dadosSalasTarde },
                noite: { nome: "", dados: dadosSalasNoite },
                noiteTecnico: { nome: "", dados: dadosSalasNoiteTecnico }
            };

            // Função para criar uma seção para cada período
            function criarSecao(periodo, nome) {
                const dados = periodos[periodo].dados;
                if (!dados.length) return;

                // Criar um título para o período
                const titulo = document.createElement('h2');
                titulo.textContent = nome;
                titulo.style.color = "#ffcc00";
                container.appendChild(titulo);

                // Criar uma div para organizar as salas desse período
                const divPeriodo = document.createElement('div');
                divPeriodo.classList.add('periodo');

                const divSalas = document.createElement('div');
                divSalas.classList.add('salas');

                // Filtrar os dados das salas e gerar as tabelas
                dados.forEach(sala => {
                    const horariosFiltrados = sala.horarios.filter(horario =>
                        horario.dia === diaSelecionado &&
                        (horarioSelecionado === "" || horario.horario === horarioSelecionado)
                    );

                    if (horariosFiltrados.length > 0) {
                        const divSala = document.createElement('div');
                        divSala.classList.add('sala');
                        divSala.innerHTML = `<h3>${sala.nome}</h3>`;

                        const tabela = document.createElement('table');
                        tabela.innerHTML = `
                            <tr>
                                <th>Disciplina</th>
                                <th>Professor</th>
                                <th>Horário</th>
                            </tr>
                        `;

                        horariosFiltrados.forEach(horario => {
                            tabela.innerHTML += `
                                <tr>
                                    <td>${horario.disciplina || '---'}</td>
                                    <td>${horario.professor || '---'}</td>
                                    <td>${horario.horario}</td>
                                </tr>
                            `;
                        });

                        divSala.appendChild(tabela);
                        divSalas.appendChild(divSala);
                    }
                });
                
                const h2 = document.createElement("h2");
                h2.style.color = "#ffcc00";
                h2.textContent = capitalizeWords(periodo); // Define o texto do título (capitalizeWords("período da manhã"));
                if (h2.textContent == "NoiteTecnico"){ h2.textContent == "Noite Técnico"}
                h2.classList.add('periodo')

                divPeriodo.appendChild(h2);
                divPeriodo.appendChild(divSalas);
                container.appendChild(divPeriodo);
            }

            // Se um período específico foi escolhido, exibe apenas ele
            if (periodoSelecionado !== "todos") {
                criarSecao(periodoSelecionado, periodos[periodoSelecionado].nome);
            } else {
                // Se "Todos os períodos" foi selecionado, exibe todos separadamente
                Object.keys(periodos).forEach(periodo => criarSecao(periodo, periodos[periodo].nome));
            }
        }
        window.onload = function() {
            const diasDaSemana = ["Segunda", "Terça", "Quarta", "Quinta", "Sexta"];
            const selectElement = document.getElementById("dia-semana");

            const hoje = new Date();
            const diaDaSemana = hoje.getDay(); // 0: Domingo, 1: Segunda, ..., 6: Sábado

            // Ajuste o índice do dia da semana
            const diaSelecionado = diasDaSemana[diaDaSemana - 1]; // Para ajustar a correspondência

            // Definir o valor selecionado com base no dia da semana
            if (diasDaSemana.includes(diaSelecionado)) {
                selectElement.value = diaSelecionado;
            }
        };
    </script>
</body>
</html>
